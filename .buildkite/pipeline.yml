steps:
  # TODO: Figure out how to pass artifacts across steps
  - label: 'Install'
    command: |
      yarn --frozen-lockfile
      tar -czf node_modules.tar.gz node_modules
    artifact_paths:
      - 'node_modules.tar.gz'

  - wait

  - label: ':jest: Jest tests'
    command: |
      buildkite-agent artifact download node_modules.tar.gz
      tar -xf node_modules.tar.gz node_modules
      yarn test

  - label: ':cypress: Cypress Tests'
    # command: 'yarn cy:run:ci'
    plugins:
      - docker-compose#v3.3.0:
          run: cypress
